<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation Guide &mdash; AlTar 2.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User Guide" href="Manual.html" />
    <link rel="prev" title="Bayesian Inference for Inverse Problems" href="Background.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> AlTar
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Preface.html">Preface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-platforms">Supported Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hardware">Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation-systems">Operation systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#downloads">Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-with-cmake">Install with CMake</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-steps">General steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cmake-options">CMake Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation-path">Installation path</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-disable-cuda">Enable/disable CUDA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#target-gpu-architecture-s">Target GPU architecture(s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-compiler">C++ Compiler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cuda-compiler">CUDA Compiler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blas-library">BLAS Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#library-search-path">Library search path</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-type">Build type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-compiling-details">Show compiling details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#more-options">More options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conda-method-linux-macosx">Conda method (Linux/MacOSX)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-anaconda-miniconda">Install Anaconda/Miniconda</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-conda-packages">Install Conda packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">C++ Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cuda-compiler-nvcc">CUDA compiler (nvcc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-pyre-and-altar">Download pyre and AlTar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-pyre">Install pyre</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-altar">Install AlTar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpi-setup">MPI setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#linux-systems">Linux Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ubuntu-18-04-20-04">Ubuntu 18.04/20.04</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-prerequisites">Install prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-pyre-altar">Install pyre/AlTar</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rhel-centos-7">RHEL/CentOS 7</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Install prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">Install pyre/AlTar</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linux-with-software-modules">Linux with software modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker-container">Docker container</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-with-the-mm-build-tool">Install with the mm build tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#download-mm-build-tool">Download <code class="docutils literal notranslate"><span class="pre">mm</span></code> build tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prepare-a-config-mm-file">Prepare a <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Install pyre</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Install AlTar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tests-and-examples">Tests and Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Manual.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Programming.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Issues.html">Common Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AlTar</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Installation Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cuda/Installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="installation-guide">
<span id="id1"></span><h1>Installation Guide<a class="headerlink" href="#installation-guide" title="Permalink to this headline"></a></h1>
<section id="overview">
<span id="installation-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://github.com/AlTarFramework/altar">AlTar</a> is developed upon the <a class="reference external" href="https://github.com/pyre/pyre">pyre</a> framework. Both packages may be installed from the source code with the <a class="reference external" href="https://cmake.org">CMake</a>  build tool. More installation methods, e.g., binaries, will be provided in the future.</p>
<p>In brief, the installation steps consist of:</p>
<ol class="arabic simple">
<li><p>check <a class="reference internal" href="#platforms"><span class="std std-ref">Supported Platforms</span></a> and install <a class="reference internal" href="#prerequisites"><span class="std std-ref">Prerequisites</span></a>;</p></li>
<li><p><a class="reference internal" href="#downloads"><span class="std std-ref">download</span></a> the source packages from github;</p></li>
<li><p>follow the <a class="reference internal" href="#general-steps"><span class="std std-ref">Installation Guide</span></a> to compile/install <code class="docutils literal notranslate"><span class="pre">pyre</span></code> and <code class="docutils literal notranslate"><span class="pre">altar</span></code>.</p></li>
</ol>
<p>Step-by-step instructions are also provided for some representative systems:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#anaconda3"><span class="std std-ref">Conda method</span></a> <em>recommended method for Linux, Linux Clusters and MacOSX</em></p></li>
<li><p><a class="reference internal" href="#ubuntu"><span class="std std-ref">Ubuntu 18.04/20.04</span></a> <em>a standard platform</em></p></li>
<li><p><a class="reference internal" href="#redhat"><span class="std std-ref">RHEL/CentOS 7</span></a> <em>a standard platform</em></p></li>
<li><p><a class="reference internal" href="#lmod"><span class="std std-ref">Linux with environmental modules</span></a> <em>for Linux clusters</em></p></li>
<li><p><a class="reference internal" href="#docker"><span class="std std-ref">Docker container</span></a> <em>out-of-the-box delivery</em></p></li>
</ul>
</div></blockquote>
</section>
<section id="supported-platforms">
<span id="platforms"></span><h2>Supported Platforms<a class="headerlink" href="#supported-platforms" title="Permalink to this headline"></a></h2>
<section id="hardware">
<h3>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline"></a></h3>
<ul>
<li><p>CPU: <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> (Intel/AMD), <code class="docutils literal notranslate"><span class="pre">ppc64</span></code> (IBM), <code class="docutils literal notranslate"><span class="pre">arm64</span></code> (Apple Silicon/ARM Neoverse/Fujitsu A64FX/…)</p></li>
<li><p>GPU: <a class="reference external" href="https://en.wikipedia.org/wiki/CUDA#GPUs_supported">NVIDIA graphics cards with CUDA-support</a>, with compute capabilities &gt;=3.0</p>
<blockquote>
<div><ul class="simple">
<li><p>Server/Workstation GPUs - Tesla K40, K80, P100, V100, A100, …</p></li>
<li><p>Workstation graphic Cards - Quadro K6000, M6000, P6000, GV100, RTX x000, …</p></li>
<li><p>Gaming graphic cards GTX10x0, RTX20x0, RTX30x0, …</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>AlTar supports both single and double precision GPU computations. Most Quadro and gaming cards have limited double precision computing cores. However, single-precision simulation is sufficient for most models.</p>
</div>
</section>
<section id="operation-systems">
<h3>Operation systems<a class="headerlink" href="#operation-systems" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Linux: any distribution should work though not all have been tested;</p></li>
<li><p>Linux clusters: with MPI support and a job queue scheduler (PBS/Slurm);</p></li>
<li><p>MacOSX: with <a class="reference external" href="https://www.macports.org/">MacPorts</a> or <a class="reference external" href="https://www.anaconda.com/distribution/#macos">conda</a>;</p></li>
<li><p>Windows: not tested; <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Windows Subsystem for Linux</a> or <a class="reference external" href="https://www.cygwin.com/">Cygwin</a> should work.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>AlTar is designed for large scale simulations. We recommend clusters or a workstation with multiple GPUs for simulating compute-intensive models.</p>
</div>
</section>
<section id="prerequisites">
<span id="id2"></span><h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h3>
<p>AlTar and pyre have several dependencies:</p>
<p>Required:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Python3</span> <span class="pre">&gt;=</span> <span class="pre">3.6</span></code> with additional Python packages <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">h5py</span></code>.</p></li>
<li><p>C/C++ compiler: <code class="docutils literal notranslate"><span class="pre">GCC</span> <span class="pre">&gt;=</span> <span class="pre">gcc7</span></code>, or <code class="docutils literal notranslate"><span class="pre">clang</span> <span class="pre">&gt;=</span> <span class="pre">7</span></code>, with C++17 support. Note also that CUDA Toolkit may require certain versions of C/C++ compiler, see <a class="reference external" href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html">CUDA Documentation</a> for more details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GSL</span> <span class="pre">&gt;=</span> <span class="pre">1.15</span></code>, various numerical libraries including linear algebra and statistics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HDF5</span> <span class="pre">&gt;=</span> <span class="pre">1.10</span></code>, a data management system for large and complex data sets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Postgresql</span></code>, a SQL database management system (only the library, the server itself is not required).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">&gt;=</span> <span class="pre">4</span></code>, build tool.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">&gt;=</span> <span class="pre">3.14</span></code>, build tool. Numpy component in FindPython is only supported after 3.14.</p></li>
</ul>
<p>Optional:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MPI</span></code> for multi-thread computations on single machine or cluster system.  The recommended option is <code class="docutils literal notranslate"><span class="pre">openmpi</span> <span class="pre">&gt;</span> <span class="pre">1.10</span></code> with CXX support (note that on many cluster systems, openmpi is compiled without the <code class="docutils literal notranslate"><span class="pre">--enable-mpi-cxx</span></code> option and therefore doesn’t have the <cite>libmpi_cxx.so</cite> library). Other MPI implementations such as MPICH, Intel MPI are also supported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CUDA</span> <span class="pre">toolkit</span> <span class="pre">&gt;=</span> <span class="pre">10.0</span></code> for GPU-accelerated computations. Additional libraries including <code class="docutils literal notranslate"><span class="pre">cublas</span></code>, <code class="docutils literal notranslate"><span class="pre">curand</span></code>, and <code class="docutils literal notranslate"><span class="pre">cusolver</span></code> are also required.</p></li>
<li><p>An accelerated <code class="docutils literal notranslate"><span class="pre">BLAS</span></code> library, such as <code class="docutils literal notranslate"><span class="pre">atlas</span></code>, <code class="docutils literal notranslate"><span class="pre">openblas</span></code>, or <code class="docutils literal notranslate"><span class="pre">mkl</span></code>. Otherwise, the <code class="docutils literal notranslate"><span class="pre">gslcblas</span></code> library, as included in <code class="docutils literal notranslate"><span class="pre">GSL</span></code>, will be used by default.</p></li>
</ul>
</section>
</section>
<section id="downloads">
<span id="id3"></span><h2>Downloads<a class="headerlink" href="#downloads" title="Permalink to this headline"></a></h2>
<p>Please choose a directory where you plan to put all the source files, e.g., <code class="docutils literal notranslate"><span class="pre">${HOME}/tools/src</span></code>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir -p ${HOME}/tools/src
cd ${HOME}/tools/src
</pre></div>
</div>
<p>and download the source packages of <a class="reference external" href="https://github.com/pyre/pyre">pyre</a> and <a class="reference external" href="https://github.com/AlTarFramework/altar">AlTar</a> from their github repositories (main branch):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">pyre</span><span class="o">/</span><span class="n">pyre</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">AlTarFramework</span><span class="o">/</span><span class="n">altar</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Currently, some CUDA extensions to pyre and AlTar are not fully merged to the main branch. To install and run the CUDA version of AlTar 2.0, you need to download pyre and altar packages from <a class="reference external" href="https://github.com/lijun99/pyre">pyre cuda branch</a> and <a class="reference external" href="https://github.com/lijun99/altar">altar cuda branch</a> instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lijun99</span><span class="o">/</span><span class="n">pyre</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lijun99</span><span class="o">/</span><span class="n">altar</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pyre is under active development and sometimes the newest version doesn’t work properly for AlTar. AlTar users are recommended to obtain pyre from the <a class="reference external" href="https://github.com/lijun99/pyre">pyre cuda branch</a> even if only CPU modules are used.</p>
</div>
<p>Upon successful downloads, you shall observe two directories <code class="docutils literal notranslate"><span class="pre">pyre</span></code>, <code class="docutils literal notranslate"><span class="pre">altar</span></code> under <code class="docutils literal notranslate"><span class="pre">${HOME}/tools/src</span></code> directory.</p>
</section>
<section id="install-with-cmake">
<span id="cmake-install"></span><h2>Install with CMake<a class="headerlink" href="#install-with-cmake" title="Permalink to this headline"></a></h2>
<section id="general-steps">
<span id="id4"></span><h3>General steps<a class="headerlink" href="#general-steps" title="Permalink to this headline"></a></h3>
<p>This section provides a general instruction on installation procedures. Please refer to the following sections for more system-specific instructions.</p>
<p>Compile and install PYRE at first, with the following commands,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># enter the source directory</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/pyre
<span class="c1"># create a build directory</span>
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
<span class="c1"># call cmake to generate make files</span>
cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span>TARGET_DIR -DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="s2">&quot;xx&quot;</span>
<span class="c1"># compile</span>
make  <span class="c1"># or make -j to use multi-threads</span>
<span class="c1"># install</span>
make install <span class="c1"># or sudo make install</span>
</pre></div>
</div>
<p>By default, without using <code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX</span></code>, CMake installs the package to <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>, . If you plan to install the packages to another directory <code class="docutils literal notranslate"><span class="pre">TARGET_DIR</span></code>, you may use the <code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX</span></code> option. It is always a good practice to specify the targeted GPU architecture by, e.g, <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CUDA_ARCHITECTURES=&quot;60&quot;</span></code> (targeting NVIDIA Tesla P100 GPU) or <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CUDA_ARCHITECTURES=&quot;35;60&quot;</span></code> (targeting both K40/K80 and P100 GPUs). Please refer to <a class="reference internal" href="#cmake-options"><span class="std std-ref">CMake Options</span></a> for more details and more options.</p>
<p>The installed files will appear as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;install_prefix&gt;
   |--- bin  # executable shell scripts
   |   |- pyre, pyre-config ...
   |- defaults # default configuration files
   |   |- pyre.pfg, merlin.pfg
   |- include # c/c++ header files
   |   |- portinfo, &lt;pyre&gt;
   |- lib # shared libraries
   |   |- libjournal.so libpyre.so ... (or .dylib for Mac)
   |- packages # python packages/scripts
       |- &lt;pyre&gt;, &lt;merlin&gt;, &lt;journal&gt; ...
</pre></div>
</div>
<p>You may also run a few tests to check whether pyre is properly installed.</p>
<p>First, set up the environmental variables (you may also consider to add them to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> or <code class="docutils literal notranslate"><span class="pre">.cshrc</span></code>),</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># for bash/zsh</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/bin:<span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/lib:<span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>/usr/local/packages:<span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span>
<span class="c1"># for csh/tcsh</span>
setenv PATH <span class="s2">&quot;/usr/local/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
setenv LD_LIBRARY_PATH <span class="s2">&quot;/usr/local/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
setenv PYTHONPATH <span class="s2">&quot;/usr/local/packages:</span><span class="nv">$PYTHONPATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>then run commands such as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># check pyre module import</span>
python3 -c <span class="s1">&#39;import pyre&#39;</span>
<span class="c1"># check cuda module if enabled</span>
<span class="c1"># an error will be reported if the module couldn&#39;t find a GPU device</span>
python3 -c <span class="s1">&#39;import cuda&#39;</span>
<span class="c1"># show the pyre installation directory</span>
pyre-config --prefix
</pre></div>
</div>
<p>There are more test scripts under the source package <code class="docutils literal notranslate"><span class="pre">${HOME}/tools/src/pyre/tests</span></code>.</p>
<p>After installing PYRE and setting up properly the PATHs, you may proceed to compile/install AlTar, with the same procedure,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># enter the source directory</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/altar
<span class="c1"># create a build directory</span>
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
<span class="c1"># call cmake to generate make files</span>
cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span>TARGET_DIR -DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="s2">&quot;xx&quot;</span>
<span class="c1"># compile</span>
make  <span class="c1"># or make -j  to use multi-threads</span>
<span class="c1"># install</span>
make install <span class="c1"># or sudo make install</span>
</pre></div>
</div>
<p>By default, AlTar is also installed to <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>. If you choose to install to another directory, you may use the same <code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX</span></code> as for PYRE. By doing so, all the PATHs only need to be set once.</p>
<p>To test whether AlTar is properly installed, you may run the following commands</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># check altar module import</span>
python3 -c <span class="s1">&#39;import altar&#39;</span>
<span class="c1"># show the altar installation directory</span>
altar about prefix
</pre></div>
</div>
<p>There are also tests available in <code class="docutils literal notranslate"><span class="pre">examples</span></code> directories under each model in the source package, for example, <code class="docutils literal notranslate"><span class="pre">$(HOME)/tools/src/altar/models/linear/examples</span></code>.</p>
</section>
<section id="cmake-options">
<span id="id5"></span><h3>CMake Options<a class="headerlink" href="#cmake-options" title="Permalink to this headline"></a></h3>
<p>Here are some commonly used options to control the compilation/installation.</p>
<section id="installation-path">
<h4>Installation path<a class="headerlink" href="#installation-path" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools ..
</pre></div>
</div>
<p>By default,  <code class="docutils literal notranslate"><span class="pre">cmake</span></code> installs the compiled package to <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>. If you plan to install it to another system directory, or your home directory (for users who don’t have admin access), such as ${HOME}/tools as shown above. Remember to set properly the environmental variables <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>. If you use <code class="docutils literal notranslate"><span class="pre">Conda</span></code>, you may use <code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX=$CONDA_PREFIX</span></code>.</p>
</section>
<section id="enable-disable-cuda">
<h4>Enable/disable CUDA<a class="headerlink" href="#enable-disable-cuda" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DWITH_CUDA<span class="o">=</span>ON <span class="o">(</span>or OFF<span class="o">)</span> ..
</pre></div>
</div>
<p>By default, <cite>WITH_CUDA=ON</cite> for the cuda branch version and <cite>WITH_CUDA=OFF</cite> for the main branch version. To enable CUDA extensions, you will also need the CUDA Toolkit. If not found, <code class="docutils literal notranslate"><span class="pre">cmake</span></code> will automatically turn <cite>WITH_CUDA=OFF</cite>.</p>
</section>
<section id="target-gpu-architecture-s">
<span id="gpu-architecture"></span><h4>Target GPU architecture(s)<a class="headerlink" href="#target-gpu-architecture-s" title="Permalink to this headline"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We recommend specifying a proper GPU architecture with <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CUDA_ARCHITECTURES=&quot;xx&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CUDA_FLAGS=&quot;-arch=sm_xx&quot;</span></code>. It not only ensures the efficient GPU executable code for your device, but also avoids the issue of code incompatibilities. CUDA Toolkit 9 and 10 use <code class="docutils literal notranslate"><span class="pre">sm_30</span></code> as the default target architecture, while CUDA 11 uses <code class="docutils literal notranslate"><span class="pre">sm_52</span></code>. The compiled code will continue to run on GPU devices with higher compute capabilities, but not on GPU devices with lower compute capabilities, reporting an error <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">kernel</span> <span class="pre">image</span> <span class="pre">is</span> <span class="pre">available</span> <span class="pre">for</span> <span class="pre">execution</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">device.</span></code> This happens, e.g., when you have a K40 (<code class="docutils literal notranslate"><span class="pre">sm_35</span></code>) and use a <code class="docutils literal notranslate"><span class="pre">sm_52</span></code> flag (default by CUDA 11). AlTar does not support CUDA on Mac, and <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CUDA_FLAGS=...</span></code> will be neglected if provided.</p>
</div>
<p>To specify the targeted GPU architecture(s),</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># target one architecture</span>
cmake -DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="s2">&quot;60&quot;</span> ..
<span class="c1"># target multiple architectures</span>
cmake -DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="s2">&quot;35;60&quot;</span> ..
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">CUDA_ARCHITECTURES</span></code> is only available on CMake 3.18 and later versions. For earlier versions, you may use <code class="docutils literal notranslate"><span class="pre">CUDA_FLAGS</span></code> instead,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># target one architecture</span>
cmake -DCMAKE_CUDA_FLAGS<span class="o">=</span><span class="s2">&quot;-arch=sm_60&quot;</span> ..
<span class="c1"># target multiple architectures</span>
cmake -DCMAKE_CUDA_FLAGS<span class="o">=</span><span class="s2">&quot;-gencode arch=compute_35,code=sm_35 -gencode arch=compute_60,code=sm_60&quot;</span> ..
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CUDA_FLAGS</span></code> may also be used to pass other compiling options to CUDA compiler <code class="docutils literal notranslate"><span class="pre">nvcc</span></code>.</p>
<p>You may find out which type(s) of GPU are installed by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nvidia-smi
</pre></div>
</div>
<p>Compute capabilities for some common NVIDIA GPUs are K40/80 (<code class="docutils literal notranslate"><span class="pre">sm_35</span></code>), V100 (<code class="docutils literal notranslate"><span class="pre">sm_70</span></code>), A100 (<code class="docutils literal notranslate"><span class="pre">sm_80</span></code>), GTX1050/1070/1080 ((<code class="docutils literal notranslate"><span class="pre">sm_61</span></code>), RTX 2060/2070/2080 (<code class="docutils literal notranslate"><span class="pre">sm_75</span></code>), RTX 3060/3070/3080(<code class="docutils literal notranslate"><span class="pre">sm_86</span></code>. More details can be found at <a class="reference external" href="https://developer.nvidia.com/cuda-GPUs">NVIDIA</a> website. If pyre is already installed, you may also use its cuda utilities to find out:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -c <span class="s2">&quot;import cuda; [print(f&#39;Device {device.id} {device.name} has compute capability {device.capability}&#39;) for device in cuda.devices]&quot;</span>
</pre></div>
</div>
</section>
<section id="c-compiler">
<h4>C++ Compiler<a class="headerlink" href="#c-compiler" title="Permalink to this headline"></a></h4>
<p>To specify the C++ compiler, e.g., <cite>/usr/bin/g++</cite>, you may use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_CXX_COMPILER<span class="o">=</span>/usr/bin/g++ ..
</pre></div>
</div>
<p>Note that pyre requires a GCC&gt;=7 for c++17 support.</p>
<p>C++ compiler may also be specified from the environmental variable <code class="docutils literal notranslate"><span class="pre">CXX</span></code>, for example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># bash/zsh</span>
<span class="nb">export</span> <span class="nv">CXX</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/g++&quot;</span>
<span class="c1"># csh/tcsh</span>
setenv CXX  <span class="s2">&quot;/usr/bin/g++&quot;</span>
</pre></div>
</div>
</section>
<section id="cuda-compiler">
<span id="id6"></span><h4>CUDA Compiler<a class="headerlink" href="#cuda-compiler" title="Permalink to this headline"></a></h4>
<p>To specify the CUDA compiler <code class="docutils literal notranslate"><span class="pre">nvcc</span></code>, e.g., <cite>/usr/local/cuda-11.3/bin/nvcc</cite>, you may use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_CUDA_COMPILER<span class="o">=</span>/usr/local/cuda-11.3/bin/nvcc ..
</pre></div>
</div>
<p>C++ compiler may also be specified from the environmental variable <code class="docutils literal notranslate"><span class="pre">CUDACXX</span></code>, for example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># bash/zsh</span>
<span class="nb">export</span> <span class="nv">CUDACXX</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/cuda-11.3/bin/nvcc -arch=sm_60&quot;</span>
<span class="c1"># csh/tcsh</span>
setenv CUDACXX  <span class="s2">&quot;/usr/local/cuda-11.3/bin/nvcc -arch=sm_60&quot;</span>
</pre></div>
</div>
</section>
<section id="blas-library">
<h4>BLAS Library<a class="headerlink" href="#blas-library" title="Permalink to this headline"></a></h4>
<p>Pyre requires a BLAS library for its <code class="docutils literal notranslate"><span class="pre">gsl</span></code> module. CMake searches automatically an available BLAS library by default. If none is found, the <code class="docutils literal notranslate"><span class="pre">gslcblas</span></code> library included with GSL package will be used. You may also specify which BLAS library to use by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake .. -DBLA_VENDOR<span class="o">=</span>vendor
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">vendor</span></code> can be <code class="docutils literal notranslate"><span class="pre">Generic``(``libblas.so</span></code>), <code class="docutils literal notranslate"><span class="pre">ATLAS</span></code>, <code class="docutils literal notranslate"><span class="pre">Intel10_64lp</span></code>, <code class="docutils literal notranslate"><span class="pre">OpenBLAS</span></code> …. You may also add <code class="docutils literal notranslate"><span class="pre">-DCMAKE_PREFIX_PATH=/path/to/blas</span></code> to enforce a search path.</p>
</section>
<section id="library-search-path">
<h4>Library search path<a class="headerlink" href="#library-search-path" title="Permalink to this headline"></a></h4>
<p>To specify the locations of a prerequisite library instead of the default one, for example, on some Linux systems, <code class="docutils literal notranslate"><span class="pre">cmake</span></code> may find and use libraries from <code class="docutils literal notranslate"><span class="pre">/usr/</span></code> instead of the libraries provided by conda, you may use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_PREFIX_PATH<span class="o">=</span><span class="si">${</span><span class="nv">CONDA_PREFIX</span><span class="si">}</span> ..
</pre></div>
</div>
<p>to enforce libraries installed under Conda to be used.</p>
<p>For more than one paths, use a semicolon separated list, <cite>-DCMAKE_PREFIX_PATH=”PATH1;PATH2;PATH3”</cite>.</p>
</section>
<section id="build-type">
<h4>Build type<a class="headerlink" href="#build-type" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Release <span class="o">(</span>or Debug<span class="o">)</span> ..
</pre></div>
</div>
<p>For the Debug build type, the <code class="docutils literal notranslate"><span class="pre">-g</span></code> compiler flag will be added to generate debugging information. For the Release type, the <code class="docutils literal notranslate"><span class="pre">-O3</span></code> optimization flag will be added. If none is specified, the default flags of <code class="docutils literal notranslate"><span class="pre">g++</span></code> are used.</p>
</section>
<section id="show-compiling-details">
<h4>Show compiling details<a class="headerlink" href="#show-compiling-details" title="Permalink to this headline"></a></h4>
<p>By default, the compiling step <code class="docutils literal notranslate"><span class="pre">make</span></code> only shows one line summary of each file being compiled. To the detailed compiling command and options, you may use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</section>
<section id="more-options">
<h4>More options<a class="headerlink" href="#more-options" title="Permalink to this headline"></a></h4>
<p>For more options of <code class="docutils literal notranslate"><span class="pre">cmake</span></code>, please check <a class="reference external" href="https://cmake.org/documentation/">CMake Documentation</a>.</p>
</section>
</section>
</section>
<section id="conda-method-linux-macosx">
<span id="anaconda3"></span><h2>Conda method (Linux/MacOSX)<a class="headerlink" href="#conda-method-linux-macosx" title="Permalink to this headline"></a></h2>
<section id="install-anaconda-miniconda">
<h3>Install Anaconda/Miniconda<a class="headerlink" href="#install-anaconda-miniconda" title="Permalink to this headline"></a></h3>
<p>Conda(Anaconda/Miniconda) offers an easy way to install Python, packages and libraries on different platforms, especially for users without the admin privilege to their computers. We recommend a full version of <a class="reference external" href="https://www.anaconda.com/distribution/">Anaconda3</a>. If disk space is an issue or you plan to use a virtual environment, you may use <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a> instead.</p>
<p>For MacOSX with Apple Silicon, you may install the native <code class="docutils literal notranslate"><span class="pre">arm64</span></code> version from <a class="reference external" href="https://github.com/conda-forge/miniforge">Miniforge</a>.</p>
<p>If Anaconda3 is not installed, please <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/download.html">download</a> and follow the <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/">instructions</a> to install it. You may choose to install it under you home directory <code class="docutils literal notranslate"><span class="pre">${HOME}/anaconda3</span></code> (default) or a system directory, e.g., <code class="docutils literal notranslate"><span class="pre">/opt/anaconda3</span></code>. The path to the Anaconda3 is set as an environmental variable <code class="docutils literal notranslate"><span class="pre">CONDA_PREFIX</span></code>. To check whether Anaconda3 is properly installed and loaded, you may try the following commands</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ which conda
/opt/anaconda3/bin/conda
$ which python3
/opt/anaconda3/bin/python3
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">CONDA_PREFIX</span><span class="si">}</span>
/opt/anaconda3
</pre></div>
</div>
<p>You may also create a virtual environment</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conda create -n altar
$ conda activate altar
$ which python3
/opt/anaconda3/envs/altar/bin/python3
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">CONDA_PREFIX</span><span class="si">}</span>
/opt/anaconda3/envs/altar
</pre></div>
</div>
</section>
<section id="install-conda-packages">
<h3>Install Conda packages<a class="headerlink" href="#install-conda-packages" title="Permalink to this headline"></a></h3>
<p>Install the required libraries and packages by Conda:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conda install git make cmake hdf5 h5py openmpi gsl openblas postgresql numpy scipy
</pre></div>
</div>
</section>
<section id="id7">
<h3>C++ Compiler<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<p>You will also need a c++ compiler.</p>
<ul class="simple">
<li><p><strong>Ubuntu 18.04/20.04</strong>  GCC 7.4.0/9.3.0 is installed by default and is sufficient. If GCC/G++ are not installed, run</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt install gcc g++
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Redhat/CentOS 7</strong> The system default compiler GCC 4.x doesn’t support C++17. Higher versions of GCC are offered through <code class="docutils literal notranslate"><span class="pre">devtoolset</span></code>. Please follow instructions for <a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/7/">Redhat</a> or <a class="reference external" href="https://www.softwarecollections.org/en/scls/rhscl/devtoolset-7/">CentOS</a> to install, e.g., <code class="docutils literal notranslate"><span class="pre">devtoolset-7</span></code>. An alternative is to use GNU compilers provided by Conda, see below.</p></li>
<li><p><strong>MacOSX</strong> You will need to install either the full version of Xcode or the (compact) Command Line Tools. Xcode can be installed from the App Store. To install the Command Line Tools, run</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo xcode-select --install
<span class="c1"># To select or switch compilers,</span>
sudo xcode-select --switch /Library/Developer/CommandLineTools/
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Conda GNU Compilers</strong> Conda also offers compiler packages, which work well for most Linux/MacOSX(Intel) systems,</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># for Linux x86_64</span>
conda install gcc_linux-64 gxx_linux-64
<span class="c1"># for Mac (Intel Only)</span>
conda install clang_osx-64 clangxx_osx-64
<span class="c1"># for Mac Big Sur with Xcode 12 (Intel only), you need to use clang-11,</span>
conda install clang_osx-64<span class="o">=</span><span class="m">11</span>.0.0 clangxx_osx-64<span class="o">=</span><span class="m">11</span>.0.0 -c conda-forge
<span class="c1"># for Mac with Apple Silicon, please use only Command Line Tools or Xcode</span>
</pre></div>
</div>
<p>If you would like to use a c++ compiler other than the default version, or the version (auto) discovered by <code class="docutils literal notranslate"><span class="pre">cmake</span></code>, you may use <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CXX_COMPILER=...</span></code> to specify the compiler.</p>
</section>
<section id="cuda-compiler-nvcc">
<span id="cuda-toolkit"></span><h3>CUDA compiler (nvcc)<a class="headerlink" href="#cuda-compiler-nvcc" title="Permalink to this headline"></a></h3>
<p>CUDA Toolkit integrates tools to develop GPU applications, including the compiler (<code class="docutils literal notranslate"><span class="pre">nvcc</span></code>), libraries (<code class="docutils literal notranslate"><span class="pre">libcudart.so</span></code>, <code class="docutils literal notranslate"><span class="pre">libcublas.so</span></code> …). If CUDA is installed, you may obtain and install CUDA Toolkit following the <a class="reference external" href="https://docs.nvidia.com/cuda/cuda-quick-start-guide/index.html">NVIDIA Toolkit Documentation</a>.</p>
<p>CUDA Toolkit is usually installed to <code class="docutils literal notranslate"><span class="pre">/usr/local/cuda</span></code>. On Linux clusters, many version of CUDA toolkit may be provided as modules. You may select a version by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module load cuda/11.3
</pre></div>
</div>
<p>Conda also provides a CUDA Toolkit package,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install cudatoolkit
</pre></div>
</div>
<p>which is installed to <code class="docutils literal notranslate"><span class="pre">$CONDA_PREFIX</span></code> directory.</p>
<p>You may check the CUDA Toolkit installation by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># check the nvcc availability and path</span>
$ which nvcc
/usr/local/cuda/bin/nvcc
<span class="c1"># check the CUDA Toolkit version</span>
$ nvcc --version
nvcc: NVIDIA <span class="o">(</span>R<span class="o">)</span> Cuda compiler driver
Cuda compilation tools, release <span class="m">11</span>.3, V11.3.109
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CMake</span></code> discovers the default <code class="docutils literal notranslate"><span class="pre">nvcc</span></code> command to compile CUDA programs. You may also specify anther CUDA compiler by <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CUDA_COMPILER=/path/to/nvcc</span></code>.</p>
<p>Note that NVIDIA driver, including the CUDA driver (<code class="docutils literal notranslate"><span class="pre">libcuda.so</span></code>), is required on a GPU workstation or GPU nodes in a cluster. NVIDIA drivers can only be installed/updated by <em>root</em> users.  You may check their availability and versions by the command <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>. CUDA shared libraries should also be available on GPU workstations.</p>
</section>
<section id="download-pyre-and-altar">
<h3>Download pyre and AlTar<a class="headerlink" href="#download-pyre-and-altar" title="Permalink to this headline"></a></h3>
<p>Please download the source packages of pyre/AlTar from github following the <a class="reference internal" href="#downloads"><span class="std std-ref">Download instructions</span></a>. Taking CUDA branch versions as an example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src
<span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src
git clone https://github.com/lijun99/pyre.git
git clone https://github.com/lijun99/altar.git
</pre></div>
</div>
</section>
<section id="install-pyre">
<h3>Install pyre<a class="headerlink" href="#install-pyre" title="Permalink to this headline"></a></h3>
<p>With Conda, we recommend installing pyre and AlTar to <code class="docutils literal notranslate"><span class="pre">$CONDA_PREFIX</span></code>, so that both packages are loaded automatically when conda or conda venv is activated.  We need an extra step to make a symbolic link to <code class="docutils literal notranslate"><span class="pre">lib/python3.x/site-packages</span></code>,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the python command returns the path of site-packages, and we link it as $CONDA_PREFIX/packages</span>
ln -sf <span class="sb">`</span>python3 -c <span class="s1">&#39;import site; print(site.getsitepackages()[0])&#39;</span><span class="sb">`</span> <span class="nv">$CONDA_PREFIX</span>/packages
</pre></div>
</div>
<p>Compile and install pyre</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/pyre
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$CONDA_PREFIX</span> -DCMAKE_PREFIX_PATH<span class="o">=</span><span class="nv">$CONDA_PREFIX</span> -DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="s2">&quot;60&quot;</span> -DBLA_VENDOR<span class="o">=</span>OpenBLAS
make -j <span class="o">&amp;&amp;</span> make install
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">INSTALL_PREFIX</span></code> is the installation path and <code class="docutils literal notranslate"><span class="pre">PREFIX_PATH</span></code> is the path to search the prerequisite packages. Replace <code class="docutils literal notranslate"><span class="pre">60</span></code> with appropriate compute capability number(s) for your GPU(s). See <a class="reference internal" href="#gpu-architecture"><span class="std std-ref">GPU architecture(s)</span></a> for more details.</p>
</section>
<section id="install-altar">
<h3>Install AlTar<a class="headerlink" href="#install-altar" title="Permalink to this headline"></a></h3>
<p>Since pyre is installed to <code class="docutils literal notranslate"><span class="pre">$CONDA_PREFIX</span></code>, there is no need to set the PATHs. We proceed to compile and install AlTar, with the same procedure,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/altar
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$CONDA_PREFIX</span> -DCMAKE_PREFIX_PATH<span class="o">=</span><span class="nv">$CONDA_PREFIX</span> -DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="s2">&quot;60&quot;</span>
make -j <span class="o">&amp;&amp;</span> make install
</pre></div>
</div>
<p>Please read <a class="reference internal" href="#cmake-options"><span class="std std-ref">CMake Options</span></a> if you have some problems or need more customizations. Please also read <a class="reference internal" href="#general-steps"><span class="std std-ref">Installation instructions</span></a> on how to make tests.</p>
<p>For future runs, you may simply activate conda or the conda venv to load AlTar,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># activate altar if it is installed in a venv</span>
conda activate altar
<span class="c1"># test</span>
altar about
</pre></div>
</div>
</section>
<section id="mpi-setup">
<span id="id8"></span><h3>MPI setup<a class="headerlink" href="#mpi-setup" title="Permalink to this headline"></a></h3>
<p>AlTar runs MPI jobs by automatically forking multiple threads and invoking <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> command with any AlTar Application, a capability offered by pyre <code class="docutils literal notranslate"><span class="pre">mpi</span></code> shell. However, pyre sometimes does not recognize the Conda-installed openMPI. You will need to create manually a configuration file, <code class="docutils literal notranslate"><span class="pre">mpi.pfg</span></code>, either under <code class="docutils literal notranslate"><span class="pre">$(HOME)/.pyre</span></code> directory or under the current job directory, as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; mpi.pfg file

mpi.shells.mpirun:
  ; mpi implementation
  mpi = openmpi#mpi_conda

; mpi configuration
pyre.externals.mpi.openmpi # mpi_conda:
  version = 4.0.5
  launcher = mpirun
  prefix = /opt/anaconda3/envs/altar
  bindir = {mpi_conda.prefix}/bin
  incdir = {mpi_conda.prefix}/include
  libdir = {mpi_conda.prefix}/lib
</pre></div>
</div>
<p>You need to replace <code class="docutils literal notranslate"><span class="pre">/opt/anaconda3/envs/altar</span></code> with the actual path of your <code class="docutils literal notranslate"><span class="pre">$CONDA_PREFIX</span></code>, which can be revealed by the command <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$CONDA_PREFIX</span></code>.</p>
<p>Another option is to insert these lines to your job configuration file, without creating a separate <code class="docutils literal notranslate"><span class="pre">mpi.pfg</span></code> file.</p>
<p>This setup procedure also applies to other MPIs not automatically recognized by pyre, e.g., loaded by environmental modules.</p>
</section>
</section>
<section id="linux-systems">
<span id="linux"></span><h2>Linux Systems<a class="headerlink" href="#linux-systems" title="Permalink to this headline"></a></h2>
<p>We recommend Conda methods for all Linux systems. If you prefer to use the standard Linux packages, please follow the instructions in this section.</p>
<section id="ubuntu-18-04-20-04">
<span id="ubuntu"></span><h3>Ubuntu 18.04/20.04<a class="headerlink" href="#ubuntu-18-04-20-04" title="Permalink to this headline"></a></h3>
<section id="install-prerequisites">
<h4>Install prerequisites<a class="headerlink" href="#install-prerequisites" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt update <span class="o">&amp;&amp;</span> sudo apt install -y gcc g++ python3 python3-dev python3-numpy python3-scipy python3-h5py libgsl-dev libopenblas-dev libpq-dev postgresql-server-dev-all libopenmpi-dev libhdf5-serial-dev make git
</pre></div>
</div>
<p>For Ubuntu 18.04 only: the system CMake version is 3.10; you need to manually upgrade cmake from <a class="reference external" href="https://apt.kitware.com/">Kitware Repo</a>,  e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc <span class="m">2</span>&gt;/dev/null <span class="p">|</span> sudo apt-key add -
$ sudo apt-add-repository <span class="s1">&#39;deb https://apt.kitware.com/ubuntu/ bionic main&#39;</span>
$ sudo apt-get update
$ sudo apt-get install cmake
</pre></div>
</div>
<p>To install/run CUDA modules, you will also need to install CUDA Toolkit if it is not pre-installed. See <a class="reference internal" href="#cuda-toolkit"><span class="std std-ref">CUDA compiler (nvcc)</span></a> for more details.</p>
</section>
<section id="install-pyre-altar">
<h4>Install pyre/AlTar<a class="headerlink" href="#install-pyre-altar" title="Permalink to this headline"></a></h4>
<p>Please follow the instructions in <a class="reference internal" href="#general-steps"><span class="std std-ref">General steps</span></a>.</p>
</section>
</section>
<section id="rhel-centos-7">
<span id="redhat"></span><h3>RHEL/CentOS 7<a class="headerlink" href="#rhel-centos-7" title="Permalink to this headline"></a></h3>
<section id="id9">
<h4>Install prerequisites<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<p>Enable EPEL repo</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
</pre></div>
</div>
<p>and install prerequisites</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum install -y python3 python3-devel hdf5-devel gsl-devel postgresql-devel openmpi openmpi-devel git environment-modules
<span class="c1"># install numpy/scipy/h5py via pip</span>
pip3 install numpy scipy h5py
<span class="c1"># load openmpi</span>
module load mpi
<span class="c1"># install cmake from Kitware</span>
wget https://github.com/Kitware/CMake/releases/download/v3.19.3/cmake-3.19.3-Linux-x86_64.sh
sh cmake-3.19.3-Linux-x86_64.sh  --skip-license --prefix<span class="o">=</span>/usr/local
</pre></div>
</div>
<p>Install C/C++ compiler</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Install a package with repository for your system:</span>
<span class="c1"># On CentOS, install package centos-release-scl available in CentOS repository:</span>
sudo yum install centos-release-scl

<span class="c1"># On RHEL, enable RHSCL repository for you system:</span>
sudo yum-config-manager --enable rhel-server-rhscl-7-rpms

<span class="c1"># 2. Install the collection:</span>
sudo yum install devtoolset-7

<span class="c1"># 3. Start using software collections:</span>
scl <span class="nb">enable</span> devtoolset-7 bash
</pre></div>
</div>
</section>
<section id="id10">
<h4>Install pyre/AlTar<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h4>
<p>Please follow the instructions in <a class="reference internal" href="#general-steps"><span class="std std-ref">General steps</span></a>.</p>
</section>
</section>
<section id="linux-with-software-modules">
<span id="lmod"></span><h3>Linux with software modules<a class="headerlink" href="#linux-with-software-modules" title="Permalink to this headline"></a></h3>
<p>Many clusters use software modules to load libraries and software packages, e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># list available modules</span>
module av
<span class="c1"># load a certain module</span>
module load cuda/10.2
<span class="c1"># list loaded modules</span>
module list
<span class="c1"># show the loaded module information</span>
module show cuda
</pre></div>
</div>
<p>Please load all necessary modules as listed in <a class="reference internal" href="#prerequisites"><span class="std std-ref">Prerequisites</span></a>. You may then follow the <a class="reference internal" href="#general-steps"><span class="std std-ref">General steps</span></a> above to install pyre and AlTar.</p>
<p>Since modules are set up differently in different computers, we only provide a general prescription if CMake fails to locate the prerequisite package from auto search.</p>
<p>You may provide the package path to CMake by,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-DCMAKE_PREFIX_PATH</span></code>, which specifies the package installation prefix to be searched. Files are expected to be arranged in a standard fashion under prefix, <code class="docutils literal notranslate"><span class="pre">bin</span></code>, <code class="docutils literal notranslate"><span class="pre">includes</span></code>, <code class="docutils literal notranslate"><span class="pre">lib</span></code>. If the files are not arranged in the standard way, you may use options below,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DCMAKE_INCLUDE_PATH</span></code>, which specifies the search path(s) for header files;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DCMAKE_LIBRARY_PATH</span></code>. which specifies the search paths(s) for library files.</p></li>
</ul>
</div></blockquote>
<p>Each of these three parameters can be a semicolon-separated list to include more than one paths, e.g., <code class="docutils literal notranslate"><span class="pre">-DCMAKE_PREFIX_PATH=&quot;/PATH/To/GSL;/PATH/To/HDF5;/PATH/To/MPI</span></code>.</p>
<p>CMake uses various builtin <em>Find modules</em> to search various packages, while each <em>Find module</em> may use some <em>hints</em> to locate the package. For example, <code class="docutils literal notranslate"><span class="pre">FindGSL</span></code> uses <code class="docutils literal notranslate"><span class="pre">GSL_ROOT_DIR</span></code>, and <code class="docutils literal notranslate"><span class="pre">FindMPI</span></code> uses <code class="docutils literal notranslate"><span class="pre">MPIEXEC_EXECUTABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">MPI_HOME</span></code>. These mint may be passed as environmental variables <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">GSL_ROOT_DIR=...</span></code> or as cmake options, e.g., <code class="docutils literal notranslate"><span class="pre">-DGSL_ROOT_DIR=...</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many clusters have their own recommended MPI packages which are optimized for the specific type of interconnects. Before using these pre-installed MPI packages, please check whether they have <code class="docutils literal notranslate"><span class="pre">cxx</span></code> devel support, or <code class="docutils literal notranslate"><span class="pre">libmpi_cxx.so</span></code> is available, which is required by AlTar.</p>
</div>
</section>
</section>
<section id="docker-container">
<span id="docker"></span><h2>Docker container<a class="headerlink" href="#docker-container" title="Permalink to this headline"></a></h2>
<p>You may follow the steps below to build a docker image, based on a NVIDIA cuda 10.2 image with Ubuntu.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://gitlab.com/nvidia/container-images/cuda/raw/master/dist/ubuntu18.04/10.2/runtime/Dockerfile
docker build --build-arg <span class="nv">IMAGE_NAME</span><span class="o">=</span>nvidia/cuda . -t cuda/nvidia:10.2
docker <span class="nb">exec</span> -it cuda/nvidia:10.2
apt update <span class="o">&amp;&amp;</span> apt install -y gcc g++ python3 python3-dev python3-numpy python3-numpy-dev python3-h5py libgsl-dev libopenblas-dev libpq-dev postgresql-server-dev-all libopenmpi-dev libhdf5-serial-dev make git wget software-properties-common locales
locale-gen --no-purge --lang en_US.UTF-8 <span class="o">&amp;&amp;</span> update-locale <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 LANGUAGE
wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc <span class="m">2</span>&gt;/dev/null <span class="p">|</span> apt-key add - <span class="o">&amp;&amp;</span> apt-add-repository <span class="s1">&#39;deb https://apt.kitware.com/ubuntu/ bionic main&#39;</span> <span class="o">&amp;&amp;</span> apt-get update <span class="o">&amp;&amp;</span> apt install -y cmake
apt install -y cuda-compiler-10-2 cuda-cudart-dev-10-2 cuda-curand-dev-10-2 libcublas-dev cuda-cusolver-dev-10-2
ln -sf /usr/lib/python3/dist-packages /usr/local/packages
<span class="nb">cd</span> /usr/local/src
git clone https://github.com/lijun99/pyre.git
git clone https://github.com/lijun99/altar.git
<span class="nb">cd</span> /usr/local/src/pyre <span class="o">&amp;&amp;</span> mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build <span class="o">&amp;&amp;</span> cmake .. <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> /usr/local/src/altar <span class="o">&amp;&amp;</span> mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build <span class="o">&amp;&amp;</span> cmake .. <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> make install
<span class="nb">echo</span> <span class="s1">&#39;: &quot;${LANG:=en_US.UTF-8}&quot;; export LANG&#39;</span> &gt;&gt; /etc/profile
</pre></div>
</div>
<p>Open another terminal, find out the <em>CONTAINER ID</em> for this image, named <em>cuda/nvidia:10.2</em>, and commit the changes to a new image</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker commit CONTAINER_ID altar:2.0.2-cuda
</pre></div>
</div>
<p>To run AlTar from the container</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run --gpus all -ti -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/mnt altar:2.0.2-cuda
</pre></div>
</div>
<p>which also mounts the current directory as /mnt in the virtual system. You may go to your job directory and run AlTar from there.</p>
<p>If you meet a <code class="docutils literal notranslate"><span class="pre">UnicodeDecodeError</span></code>, you will need to <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">LANG=en_US.UTF-8</span></code> at first. See <a class="reference internal" href="Issues.html#locales"><span class="std std-ref">Locales</span></a> for more details.</p>
<p>OpenMPI may issue a warning to run MPI jobs as a <em>root</em> user, you may add the <code class="docutils literal notranslate"><span class="pre">--allow-run-as-root</span></code> option to your job configuration file as follows,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; for parallel runs
mpi.shells.mpirun:
    extra = -mca btl self,tcp --allow-run-as-root
</pre></div>
</div>
</section>
<section id="install-with-the-mm-build-tool">
<h2>Install with the <a class="reference external" href="https://github.com/aivazis/mm">mm</a> build tool<a class="headerlink" href="#install-with-the-mm-build-tool" title="Permalink to this headline"></a></h2>
<p>The <a class="reference external" href="https://github.com/aivazis/mm">mm</a> build tool (please note that it is different from the old mm, or <a class="reference external" href="https://github.com/aivazis/config">config</a> build tool) is another powerful tool to build hybrid python/c/c++/cuda applications.</p>
<section id="download-mm-build-tool">
<h3>Download <code class="docutils literal notranslate"><span class="pre">mm</span></code> build tool<a class="headerlink" href="#download-mm-build-tool" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src
git clone https://github.com/aivazis/mm.git
</pre></div>
</div>
</section>
<section id="prepare-a-config-mm-file">
<h3>Prepare a <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file<a class="headerlink" href="#prepare-a-config-mm-file" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">mm</span></code> build tool requires a <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file to locate dependent libraries or packages. Taking Ubuntu 18.04 as an example, the <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file appear as</p>
<div class="highlight-python notranslate" id="ubuntu-18-04-config"><div class="highlight"><pre><span></span><span class="c1"># file config.mm</span>

<span class="c1"># gsl</span>
<span class="n">gsl</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span>
<span class="n">gsl</span><span class="o">.</span><span class="n">incpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span>
<span class="n">gsl</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>

<span class="c1"># mpi</span>
<span class="n">mpi</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">openmpi</span><span class="o">/</span>
<span class="n">mpi</span><span class="o">.</span><span class="n">binpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">mpi</span><span class="o">.</span><span class="n">incpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">openmpi</span><span class="o">/</span><span class="n">include</span>
<span class="n">mpi</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">openmpi</span><span class="o">/</span><span class="n">lib</span>
<span class="n">mpi</span><span class="o">.</span><span class="n">flavor</span> <span class="o">=</span> <span class="n">openmpi</span>
<span class="n">mpi</span><span class="o">.</span><span class="n">executive</span> <span class="o">=</span> <span class="n">mpirun</span>

<span class="c1"># hdf5</span>
<span class="n">hdf5</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span>
<span class="n">hdf5</span><span class="o">.</span><span class="n">incpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span>
<span class="n">hdf5</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>

<span class="c1"># postgresql</span>
<span class="n">libpq</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span>
<span class="n">libpq</span><span class="o">.</span><span class="n">incpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">postgresql</span>
<span class="n">libpq</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>

<span class="c1"># openblas</span>
<span class="n">openblas</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span>
<span class="n">openblas</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>

<span class="c1"># python3</span>
<span class="n">python</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mf">3.6</span>
<span class="n">python</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span>
<span class="n">python</span><span class="o">.</span><span class="n">binpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">python</span><span class="o">.</span><span class="n">incpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">python3</span><span class="mf">.6</span><span class="n">m</span>
<span class="n">python</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.6</span>

<span class="c1"># numpy</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span>

<span class="c1"># cuda</span>
<span class="n">cuda</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span>
<span class="n">cuda</span><span class="o">.</span><span class="n">binpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">cuda</span><span class="o">.</span><span class="n">incpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">include</span>
<span class="n">cuda</span><span class="o">.</span><span class="n">libpath</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">lib64</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span>
<span class="n">cuda</span><span class="o">.</span><span class="n">libraries</span> <span class="o">:=</span> <span class="n">cudart</span> <span class="n">cublas</span> <span class="n">curand</span> <span class="n">cusolver</span>

<span class="c1"># end of file</span>
</pre></div>
</div>
<p>You may leave the <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file in the <code class="docutils literal notranslate"><span class="pre">pyre/.mm</span></code>, <code class="docutils literal notranslate"><span class="pre">altar/.mm</span></code> directories, or in the <code class="docutils literal notranslate"><span class="pre">${HOME}/.mm</span></code> directory to be shared by all projects.</p>
<p>Examples of <cite>config.mm</cite> files are available at <a class="reference external" href="https://github.com/lijun99/altar2-documentation/tree/cuda/config.mm">config.mm</a>.</p>
</section>
<section id="id11">
<h3>Install pyre<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h3>
<p>After preparing all required libraries/packages and the <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file (in <code class="docutils literal notranslate"><span class="pre">pyre/.mm</span></code> or <code class="docutils literal notranslate"><span class="pre">${HOME}/.mm</span></code>), you need to compile and install pyre at first.</p>
<p>Make an alias of the <a class="reference external" href="https://github.com/aivazis/mm">mm</a> command, in <code class="docutils literal notranslate"><span class="pre">bash</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">alias</span> <span class="nv">mm</span><span class="o">=</span><span class="s1">&#39;python3 ${HOME}/tools/src/mm/mm.py&#39;</span>
</pre></div>
</div>
<p>or in <code class="docutils literal notranslate"><span class="pre">csh/tcsh</span></code>,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">alias</span> mm <span class="s1">&#39;python3 ${HOME}/tools/src/mm/mm.py&#39;</span>
</pre></div>
</div>
<p>Now, you can compile <code class="docutils literal notranslate"><span class="pre">pyre</span></code> by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/pyre
$ mm
</pre></div>
</div>
<p>By default, the compiled files are located at <code class="docutils literal notranslate"><span class="pre">${HOME}/tools/src/pyre/products/debug-shared-linux-x86_64</span></code>. If you need to customize the installation, you can check the options offered by <code class="docutils literal notranslate"><span class="pre">mm</span></code> by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mm --help
</pre></div>
</div>
<p>For example, if you prefer to install pyre to a system folder, you may use <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> option, such as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mm --prefix<span class="o">=</span>/usr/local
</pre></div>
</div>
<p>After compiling/installation, you need to set up some environmental variables for other applications to access
<code class="docutils literal notranslate"><span class="pre">pyre</span></code>, for example, create a <code class="docutils literal notranslate"><span class="pre">${HOME}/.pyre.rc</span></code> for <code class="docutils literal notranslate"><span class="pre">bash</span></code>,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># file .pyre.rc
export PYRE_DIR=${HOME}/tools/src/pyre/products/debug-shared-linux-x86_64
export PATH=${PYRE_DIR}/bin:$PATH
export LD_LIBRARY_PATH=${PYRE_DIR}/lib:$LD_LIBRARY_PATH
export PYTHONPATH=${PYRE_DIR}/packages:$PYTHONPATH
export MM_INCLUDES=${PYRE_DIR}/include
export MM_LIBPATH=${PYRE_DIR}/lib
# end of file
</pre></div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">${HOME}/.pyre.cshrc</span></code> for <code class="docutils literal notranslate"><span class="pre">csh/tcsh</span></code>,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># file .pyre.cshrc
setenv PYRE_DIR &quot;${HOME}/tools/src/pyre/products/debug-shared-linux-x86_64&quot;
setenv PATH &quot;${PYRE_DIR}/bin:$PATH&quot;
setenv LD_LIBRARY_PATH &quot;${PYRE_DIR}/lib:$LD_LIBRARY_PATH&quot;
setenv PYTHONPATH &quot;${PYRE_DIR}/packages:$PYTHONPATH&quot;
setenv MM_INCLUDES &quot;${PYRE_DIR}/include&quot;
setenv MM_LIBPATH &quot;${PYRE_DIR}/lib&quot;
# end of file
</pre></div>
</div>
<p>You will also need to append <code class="docutils literal notranslate"><span class="pre">pyre</span></code> configurations to <code class="docutils literal notranslate"><span class="pre">${HOME}/.mm/config.mm</span></code> or <code class="docutils literal notranslate"><span class="pre">altar/.mm/config.mm</span></code> or any other application who requires <code class="docutils literal notranslate"><span class="pre">pyre</span></code>,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># append to the following lines to an existing config.mm
# pyre
pyre.dir =  ${HOME}/tools/src/pyre/products/debug-shared-linux-x86_64
pyre.libraries := pyre journal ${if ${value cuda.dir}, pyrecuda}
</pre></div>
</div>
</section>
<section id="id12">
<h3>Install AlTar<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h3>
<p>First, make sure that you have a prepared <code class="docutils literal notranslate"><span class="pre">config.mm</span></code> file, which also includes the <code class="docutils literal notranslate"><span class="pre">pyre</span></code> configuration, in either <code class="docutils literal notranslate"><span class="pre">altar/.mm/</span></code> or <code class="docutils literal notranslate"><span class="pre">${HOME}/.mm</span></code> directory.</p>
<p>Follow the same step to compile AlTar,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/altar
$ mm
</pre></div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">pyre</span></code> installation, the AlTar products are located at <code class="docutils literal notranslate"><span class="pre">${HOME}/tools/src/altar/products/debug-shared-linux-x86_64</span></code>, or the directory specified by <code class="docutils literal notranslate"><span class="pre">mm</span> <span class="pre">--prefix=</span></code>.</p>
<p>Also, you need to set up some environmental variables for <code class="docutils literal notranslate"><span class="pre">altar</span></code> as well, for example, create a <code class="docutils literal notranslate"><span class="pre">${HOME}/.altar2.rc</span></code> for <code class="docutils literal notranslate"><span class="pre">bash</span></code>,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># file .altar2.rc</span>
<span class="nb">export</span> <span class="nv">ALTAR2_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/tools/src/altar/products/debug-shared-linux-x86_64
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">ALTAR2_DIR</span><span class="si">}</span>/bin:<span class="nv">$PATH</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">ALTAR2_DIR</span><span class="si">}</span>/lib:<span class="nv">$LD_LIBRARY_PATH</span>
<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="si">${</span><span class="nv">ALTAR2_DIR</span><span class="si">}</span>/packages:<span class="nv">$PYTHONPATH</span>
<span class="c1"># end of file</span>
</pre></div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">${HOME}/.altar2.cshrc</span></code> for <code class="docutils literal notranslate"><span class="pre">csh/tcsh</span></code>,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># file .altar2.cshrc
setenv ALTAR2_DIR &quot;${HOME}/tools/src/altar/products/debug-shared-linux-x86_64&quot;
setenv PATH &quot;${ALTAR2_DIR}/bin:$PATH&quot;
setenv LD_LIBRARY_PATH &quot;${ALTAR2_DIR}/lib:$LD_LIBRARY_PATH&quot;
setenv PYTHONPATH &quot;${ALTAR2_DIR}/packages:$PYTHONPATH&quot;
# end of file
</pre></div>
</div>
<p>Before running an altar/pyre application, you need to load the altar/pyre environmental settings</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.pyre.rc
$ <span class="nb">source</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.altar2.rc
</pre></div>
</div>
</section>
</section>
<section id="tests-and-examples">
<h2>Tests and Examples<a class="headerlink" href="#tests-and-examples" title="Permalink to this headline"></a></h2>
<p>Pyre tests are available at <code class="docutils literal notranslate"><span class="pre">${HOME}/tools/src/pyre/tests</span></code>.</p>
<p>AlTar examples are are available for each model.</p>
<p>For details how to run AlTar applications, please refer to <a class="reference internal" href="Manual.html#user-guide"><span class="std std-ref">User Guide</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Background.html" class="btn btn-neutral float-left" title="Bayesian Inference for Inverse Problems" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Manual.html" class="btn btn-neutral float-right" title="User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2020 ParaSim Inc., 2010-2020 California Institute of Technology..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>